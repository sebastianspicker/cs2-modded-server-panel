<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="csrf-token" content="<%= csrfToken %>">
  <title>CS2 Server Control Panel</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <!-- Font Awesome für Icons -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  >
  <style>
    body {
      background: linear-gradient(to bottom right, #3494E6, #EC6EAD);
      font-family: Arial, sans-serif;
      color: #333;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    h1 { color: #fff; }
    .panel-box {
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .panel-box h5 {
      margin-top: 1rem;
      margin-bottom: .5rem;
      font-weight: bold;
    }
    .panel-box .btn {
      margin-bottom: 8px;
    }
    .state-list dt { font-weight: bold; }
    .input-group { display: flex; gap: 5px; margin-top: 10px; }
    .plugin-label {
      display: inline-block;
      max-width: 150px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="/css/navbar.css">
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>
  <%- include('partials/navbar') %>

  <main class="container flex-fill py-4" id="main">
    <h1 class="text-center mb-4"><%= hostname %> (<%= host %>:<%= port %>)</h1>

    <!-- Obere Zeile -->
    <div class="row">
      <!-- Links: Setup Game + State/Live -->
      <div class="col-12 col-lg-6">
        <!-- Setup Game -->
        <div class="panel-box">
          <h2 class="mb-3">Setup Game</h2>
          <form id="server_setup_form" novalidate>
            <div class="mb-3">
              <label for="team1" class="form-label">Team 1:</label>
              <input type="text" id="team1" name="team1" class="form-control">
            </div>
            <div class="mb-3">
              <label for="team2" class="form-label">Team 2:</label>
              <input type="text" id="team2" name="team2" class="form-control">
            </div>
            <div class="mb-3">
              <label for="gameType" class="form-label">Game Type:</label>
              <select id="gameType" name="game_type" class="form-select" required>
                <% gameTypes.forEach(type => { %>
                  <option value="<%= type %>"><%= type %></option>
                <% }) %>
              </select>
            </div>
            <div class="mb-3">
              <label for="gameMode" class="form-label">Game Mode:</label>
              <select id="gameMode" name="game_mode" class="form-select" required>
                <option disabled selected>Loading…</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="selectedMap" class="form-label">Map:</label>
              <select id="selectedMap" name="selectedMap" class="form-select" required>
                <option disabled selected>Choose a game mode first</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">Setup Game</button>
          </form>
        </div>

        <!-- State / Live Status -->
        <div class="panel-box">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="mb-0">State / Live Status</h2>
            <button id="refresh_status" class="btn btn-secondary btn-sm">
              <i class="fas fa-sync-alt" aria-hidden="true"></i> Refresh
            </button>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <dl class="row state-list mb-0">
                <dt class="col-6">Last Type:</dt>
                <dd class="col-6" id="last-game-type"><%= lastGameType %></dd>
                <dt class="col-6">Last Mode:</dt>
                <dd class="col-6" id="last-game-mode"><%= lastGameMode %></dd>
                <dt class="col-6">Last Map:</dt>
                <dd class="col-6" id="last-map"><%= lastMap || '–' %></dd>
              </dl>
            </div>
            <div class="col-sm-6">
              <dl class="row state-list mb-0">
                <dt class="col-6">Map:</dt>
                <dd class="col-6" id="live-map">–</dd>
                <dt class="col-6">Humans:</dt>
                <dd class="col-6" id="live-humans">–</dd>
                <dt class="col-6">Bots:</dt>
                <dd class="col-6" id="live-bots">–</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>

      <!-- Rechts: RCON + Quick Commands -->
      <div class="col-12 col-lg-6">
        <!-- RCON Commands -->
        <div class="panel-box">
          <h2 class="mb-3">RCON Commands</h2>
          <p>
            <strong>Connected:</strong> <%= connected ? 'Yes' : 'No' %>
            &nbsp;|&nbsp;
            <strong>Authenticated:</strong> <%= authenticated ? 'Yes' : 'No' %>
          </p>
          <div class="input-group mb-2">
            <input
              type="text"
              id="say_input"
              name="say_message"
              class="form-control"
              placeholder="Say as admin..."
              aria-label="Say as admin message"
              autocomplete="off"
            >
            <button id="say_input_btn" class="btn btn-primary">Say</button>
          </div>
          <div class="input-group">
            <input
              type="text"
              id="rconInput"
              name="rcon_command"
              class="form-control"
              placeholder="Send RCON command..."
              aria-label="RCON command"
              autocomplete="off"
            >
            <button id="rconInputBtn" class="btn btn-primary">Send</button>
          </div>
          <div id="rconResultBox" class="alert alert-primary mt-3" style="display:none;">
            <strong>Response:</strong>
            <pre id="rconResultText" class="mb-0"></pre>
          </div>
        </div>

        <!-- Quick Commands -->
        <div class="panel-box">
          <h2 class="mb-3">Quick Commands</h2>
          <!-- Bot Commands -->
          <h3>Bot Commands</h3>
          <div class="row g-2 mb-3">
            <div class="col-4"><button id="add_bot"       class="btn btn-secondary w-100">Add Bot</button></div>
            <div class="col-4"><button id="kill_bots"     class="btn btn-secondary w-100">Kill Bots</button></div>
            <div class="col-4"><button id="kick_all_bots" class="btn btn-warning   w-100">Kick All Bots</button></div>
          </div>
          <!-- Match Commands -->
          <h3>Match Commands</h3>
          <div class="row g-2 mb-3">
            <div class="col-3"><button id="pause_game"     class="btn btn-primary w-100">Pause</button></div>
            <div class="col-3"><button id="unpause_game"   class="btn btn-success w-100">Unpause</button></div>
            <div class="col-3"><button id="restart_game"   class="btn btn-danger w-100">Restart</button></div>
            <div class="col-3"><button id="scramble_teams" class="btn btn-warning w-100">Scramble</button></div>
            <div class="col-4"><button id="start_warmup"   class="btn btn-success w-100">Warmup</button></div>
            <div class="col-4"><button id="knife_start"    class="btn btn-success w-100">Knife</button></div>
            <div class="col-4"><button id="swap_team"      class="btn btn-success w-100">Swap Teams</button></div>
            <div class="col-12"><button id="go_live"       class="btn btn-success w-100">Go Live</button></div>
          </div>
          <!-- Match Settings -->
          <h3>Match Settings</h3>
          <div class="row g-2 mb-3">
            <!-- LimitTeams -->
            <div class="col-6 d-flex">
              <button id="limitteams_on" class="btn btn-info w-50 me-1">LimitTeams On</button>
              <button id="limitteams_off" class="btn btn-outline-info w-50">LimitTeams Off</button>
            </div>
            <!-- AutoTeamBalance -->
            <div class="col-6 d-flex">
              <button id="autoteam_on" class="btn btn-info w-50 me-1">AutoBalance On</button>
              <button id="autoteam_off" class="btn btn-outline-info w-50">AutoBalance Off</button>
            </div>
            <!-- FriendlyFire -->
            <div class="col-6 d-flex">
              <button id="friendlyfire_on" class="btn btn-info w-50 me-1">FriendlyFire On</button>
              <button id="friendlyfire_off" class="btn btn-outline-info w-50">FriendlyFire Off</button>
            </div>
            <!-- AutoKick -->
            <div class="col-6 d-flex">
              <button id="autokick_on" class="btn btn-info w-50 me-1">AutoKick On</button>
              <button id="autokick_off" class="btn btn-outline-info w-50">AutoKick Off</button>
            </div>
          </div>
          <!-- Round Backups -->
          <h3>Round Backups</h3>
          <div class="row g-2">
            <div class="col-4"><button id="list_backups"         class="btn btn-secondary w-100">List</button></div>
            <div class="col-4"><button id="restore_backup"       class="btn btn-secondary w-100">Restore</button></div>
            <div class="col-4"><button id="restore_latest_backup"class="btn btn-secondary w-100">Latest</button></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Unten: Plugins -->
<!--
    <div class="row">
      <div class="col-12">
        <div class="panel-box text-start">
          <h4 class="mb-3">CS2 Plugins</h4>
          <form id="plugins_form">
            <div class="row g-2">
              <% pluginConfig.plugins.forEach(p => { %>
                <div class="col-6 col-md-4">
                  <div class="d-flex align-items-center">
                    <input
                      class="form-check-input plugin-checkbox me-2"
                      type="checkbox"
                      value="<%= p.name %>"
                      id="plugin-<%= p.name %>"
                      <%= p.defaultEnabled ? 'checked' : '' %>
                    >
                    <label class="form-check-label plugin-label me-auto"
                           for="plugin-<%= p.name %>"
                           title="<%= p.name %>">
                      <%= p.name.length > 20
                           ? p.name.substring(0,20)+'…'
                           : p.name %>
                    </label>
                    <i class="fa fa-info-circle text-secondary ms-2"
                       data-bs-toggle="tooltip" title="<%= p.description %>"></i>
                    <a href="<%= p.url %>" target="_blank" class="ms-2 text-decoration-none">
                      <i class="fa fa-globe"></i>
                    </a>
                  </div>
                </div>
              <% }) %>
            </div>
            <button type="button" id="apply_plugins" class="btn btn-primary mt-3 w-100">
              Apply Plugins
            </button>
          </form>
        </div>
      </div>
    </div>
-->

  </main>

  <!-- Übergabe an console.js -->
  <script>
    window.server_id       = '<%= server_id %>';
    window.rootPlugins     = <%- JSON.stringify(rootPlugins) %>;
    window.disabledPlugins = <%- JSON.stringify(disabledPlugins) %>;
  </script>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/console.js"></script>
</body>
</html>
